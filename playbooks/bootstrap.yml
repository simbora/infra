---
- hosts: all
  sudo: yes

  vars_prompt:
    host_name: "Set hostname"
    host_name_ip: "Set hostname ip"
  tasks:

  - name: Set hosts line
    lineinfile:
      dest=/etc/hosts
      line="{{ host_name }} {{ host_name_ip }}"

  - name: Set hostname
    hostname:
      name={{ host_name }}

  - name: Update timezone
    shell: dpkg-reconfigure --frontend noninteractive tzdata

  - name: Uncomment first line for competition
    lineinfile: backup=yes state=present dest=/etc/bash.bashrc
      regexp='^#if ! shopt -oq posix; then' backrefs=yes
      line='if ! shopt -oq posix; then'

  - name: Uncomment second line for competition
    lineinfile: backup=yes state=present dest=/etc/bash.bashrc
      regexp='^#  if \[ -f /usr/share/bash-completion/bash_completion \]\; then' backrefs=yes
      line='  if [ -f /usr/share/bash-completion/bash_completion ]; then'

  - name: Uncomment third line for competition
    lineinfile: backup=yes state=present dest=/etc/bash.bashrc
      regexp='^#    . /usr/share/bash-completion/bash_completion' backrefs=yes
      line='    . /usr/share/bash-completion/bash_completion'

  - name: Uncomment fourth line for competition
    lineinfile: backup=yes state=present dest=/etc/bash.bashrc
      regexp='^#  elif \[ -f /etc/bash_completion \]\; then' backrefs=yes
      line='  elif [ -f /etc/bash_completion ]; then'

  - name: Uncomment fifth line for competition
    lineinfile: backup=yes state=present dest=/etc/bash.bashrc
      regexp='^#    . /etc/bash_completion' backrefs=yes
      line='    . /etc/bash_completion'

  - name: Uncomment sixst line for competition
    lineinfile: backup=yes state=present dest=/etc/bash.bashrc
      regexp='^#  fi' backrefs=yes
      insertafter='    . /etc/bash_completion'
      line='  fi'

  - name: Uncomment seventh line for competition
    lineinfile: backup=yes state=present dest=/etc/bash.bashrc
      regexp='^#fi' backrefs=yes
      insertafter='  fi'
      line='fi'

  - name: Include bash.bashrc.gentoops1
    lineinfile: backup=yes state=present dest=/etc/bash.bashrc
      line="source /etc/bash.bashrc.gentoops"

  - name: File bash.bashrc.gentoops
    copy: src=files/GentooPS dest=/etc/bash.bashrc.gentoops

  - name: Append default editor to environment
    lineinfile: backup=yes state=present dest=/etc/environment
      line="EDITOR=vim"

  - name: Append rails environment to environment
    lineinfile: backup=yes state=present dest=/etc/environment
      line="RAILS_ENV=production"

  - name: File .bashrc
    copy: src=files/.bashrc dest=/root/.bashrc group=root owner=root mode=700

  - name: Append additional file to vimrc
    lineinfile: backup=yes state=present dest=/etc/vim/vimrc
      line="source /etc/vim/aditional"

  - copy: src=files/aditional dest=/etc/vim/aditional
